<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login Premium</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-white min-h-screen flex items-center justify-center">

  <div id="loginView" class="w-full max-w-md p-8 bg-gray-900 rounded-xl shadow-xl space-y-5">
    <h1 class="text-2xl font-bold text-center text-indigo-400">🔐 Login Premium</h1>
    
    <input id="username" type="text" placeholder="Username"
      class="w-full px-4 py-2 rounded bg-gray-800 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" />

    <input id="password" type="password" placeholder="Password"
      class="w-full px-4 py-2 rounded bg-gray-800 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" />

    <button id="loginBtn"
      class="w-full py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded font-semibold transition">
      Login
    </button>

    <p id="status" class="text-center text-sm text-red-400 h-5"></p>
    <div class="text-center text-sm">
      Belum punya akses? <a href="https://wa.me/6289620004252" target="_blank" class="text-green-400 underline">Buy Access</a>
    </div>
  </div>

  <div id="mainView" class="hidden w-full max-w-md p-8 bg-gray-900 rounded-xl shadow-xl space-y-5 text-center">
    <h2 class="text-2xl font-bold text-green-400">Selamat datang 👋</h2>
    <p id="welcomeUser" class="text-indigo-300"></p>
    <button id="logoutBtn" class="mt-4 px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded">
      Logout
    </button>
  </div>

  <script>
    const usersUrl = "https://raw.githubusercontent.com/khusnimr/Website-WaysModzz/refs/heads/main/users.json";

    const loginView = document.getElementById("loginView");
    const mainView = document.getElementById("mainView");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const usernameInput = document.getElementById("username");
    const passwordInput = document.getElementById("password");
    const welcomeUser = document.getElementById("welcomeUser");
    const statusEl = document.getElementById("status");

    // Ambil data user dari server.json
    async function checkCredentials(user, pass) {
      try {
        const res = await fetch(usersUrl);
        const data = await res.json();
        return data.some(u => u.username === user && u.password === pass);
      } catch (err) {
        console.error("Fetch error:", err);
        return false;
      }
    }

    // Login logic
    loginBtn.onclick = async () => {
      const user = usernameInput.value.trim();
      const pass = passwordInput.value.trim();

      if (!user || !pass) {
        statusEl.textContent = "❗ Username & password wajib diisi!";
        return;
      }

      loginBtn.disabled = true;
      statusEl.textContent = "⏳ Memproses login...";

      const valid = await checkCredentials(user, pass);
      loginBtn.disabled = false;

      if (valid) {
        localStorage.setItem("username", user);
        showMain(user);
      } else {
        statusEl.textContent = "❌ Username atau password salah!";
      }
    };

    // Tampilkan halaman utama
    function showMain(user) {
      welcomeUser.textContent = `Welcome, ${user}`;
      loginView.classList.add("hidden");
      mainView.classList.remove("hidden");
    }

    // Logout
    logoutBtn.onclick = () => {
      localStorage.removeItem("username");
      location.reload();
    };

    // Cek sesi login sebelumnya
    window.onload = () => {
      const savedUser = localStorage.getItem("username");
      if (savedUser) {
        showMain(savedUser);
      }
    };
  </script>

</body>
</html>
